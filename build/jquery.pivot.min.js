var lib;!function(a){function b(a,b,c){var d,e,f,g=[];if(a){if("function"==typeof a.map)g=a.map(b,c);else for(d=0,e=a.length;e>d;d+=1)f=b.call(c,a[d],d,a),f&&g.push(f);return g}}function c(b,c,d){var e;return e="function"==typeof b.filter?b.filter(c,d):a.map(b,function(a,b,e){return c.call(d,a,b,e)?a:null},d),e.length>0?e[0]:null}function d(a,b,c){var d,e;if(a){if("function"==typeof a.some)return a.some(b,c);for(d=0,e=a.length;e>d;d+=1)if(b.call(c,a[d],d,a))return!0}return!1}var e=function(){function a(a){this.strings=[""],this.append(a)}return a.prototype.append=function(a){null!==a&&this.strings.push(a)},a.prototype.clear=function(){this.strings.length=1},a.prototype.toString=function(){return this.strings.join("")},a}();a.StringBuilder=e,a.map=b,a.find=c,a.exists=d}(lib||(lib={}));var data;!function(a){function b(a,b){var c=+a.groupbyrank,d=+b.groupbyrank;return d>c?-1:c>d?1:0}function c(a){return"string"==typeof a||null===a?$.trim(a):a}var d=function(){function a(){this.children=[],this.pivotvalues=[]}return a.prototype.visible=function(){return void 0===this.parent||!this.parent.collapsed&&(!this.parent.visible||this.parent.visible())},a}();a.TreeNode=d;var e=function(){function a(){this.alGroupByCols=[],this.pivotCol=null,this.resultCol=null,this.bInvSort=!1,this.tree=new d,this.uniquePivotValues=[],this.dataid=null,this.sortPivotColumnHeaders=!0}return a.prototype.sortTree=function(a){var b,c;if(a.children&&a.children.length>0){for(b=0;b<a.children.length;b+=1)this.sortTree(a.children[b]);c=this.findCell(this.alGroupByCols,a.children[0].colindex).datatype,a.children.sort(this.getcomparer(this.bInvSort)[c])}},a.prototype.findCell=function(a,b){return lib.find(a,function(a){return a.colindex==this},b)},a.prototype.getcomparer=function(a){function b(b){return function(c,d){var e=b(c.sortby)<b(d.sortby)?-1:b(c.sortby)>b(d.sortby)?1:0;return a?-e:e}}return{string:b(function(a){return a}),number:b(function(a){return+a})}},a.prototype.parseJSONsource=function(a){function e(a){return a.groupbyValue==this}function f(a){return a.pivotValue==this}var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;for(this.dataid=a.dataid,g=0,h=a.columns.length;h>g;g+=1)l=a.columns[g],m={colvalue:l.colvalue,coltext:l.coltext,text:l.header||l.coltext||l.colvalue,colindex:g,datatype:l.datatype||"string",sortbycol:l.sortbycol||l.coltext||l.colvalue,dataid:l.dataid||l.colvalue,groupbyrank:l.groupbyrank},"number"==typeof m.groupbyrank&&isFinite(m.groupbyrank)?this.alGroupByCols.push(m):l.pivot?this.pivotCol=m:l.result&&(this.resultCol=m);for(this.alGroupByCols.sort(b),i=0,j=a.rows.length;j>i;i+=1){for(w=a.rows[i],n=this.tree,k=0;k<this.alGroupByCols.length;k+=1)p=c(w[this.alGroupByCols[k].colvalue]),q=w[this.alGroupByCols[k].coltext],r=c(w[this.alGroupByCols[k].sortbycol]),o=lib.find(n.children,e,p),o||(o=new d,o.groupbyValue=p,o.groupbyText=q,o.colindex=this.alGroupByCols[k].colindex,o.children=[],o.sortby=r,o.parent=n,o.dataid=this.alGroupByCols[k].dataid,o.collapsed=!0,o.groupbylevel=k,n.children.push(o)),n=o;s=c(w[this.pivotCol.colvalue]),t=c(w[this.pivotCol.sortbycol]),u=c(w[this.resultCol.colvalue]),v={pivotValue:s,result:u,sortby:t,dataid:this.pivotCol.dataid},n.pivotvalues.push(v),lib.exists(this.uniquePivotValues,f,s)||this.uniquePivotValues.push(v)}this.sortTree(this.tree),this.sortPivotColumnHeaders&&this.uniquePivotValues.sort(this.getcomparer(this.bInvSort)[this.pivotCol.datatype])},a.prototype.parseFromXhtmlTable=function(a){var b,c,d,e,f,g,h,i,j,k={dataid:a.attr("dataid"),columns:[],rows:[]},l=$("tbody > tr",a),m=[];for(b=0,c=l[0].cells.length;c>b;b+=1)f=$(l[0].cells[b]),g=f.text(),h={colvalue:f.attr("colvalue")||g,coltext:f.attr("coltext")||g,header:f.attr("header")||f.text(),datatype:f.attr("datatype"),sortbycol:f.attr("sortbycol")||g,dataid:f.attr("dataid"),groupbyrank:parseInt(f.attr("groupbyrank"),10),pivot:"true"===f.attr("pivot"),result:"true"===f.attr("result")},k.columns.push(h),m.push(g);for(d=1,e=l.length;e>d;d+=1){for(i=l[d].cells,j={},b=0,c=m.length;c>b;b+=1)g=i[b].innerHTML,j[m[b]]="number"===k.columns[b].datatype?parseFloat(g):g;k.rows.push(j)}this.parseJSONsource(k)},a}();a.adapter=e}(data||(data={})),function(a){function b(a){var b,c,d=0;for(b=0,c=a.length;c>b;b+=1)d+=a[b];return d}a.fn.pivot=function(b){function c(){if(i.onResultCellClicked){var b,c=a(this),d=c.closest("table.pivot").data("jquery.pivot.adapter"),e=[],f=c.data("def"),g=f.treeNode;for(c.closest("table.pivot").find(".resultcell").removeClass("clickedResultCell"),c.addClass("clickedResultCell");g.parent;)e.unshift({dataidGroup:g.dataid,groupbyval:g.groupbyValue}),g=g.parent;b={dataidTable:d.dataid,pivot:{dataidPivot:f.pivot.dataid,pivotvalue:f.pivot.pivotValue,pivotsortvalue:f.pivot.sortby},groups:e},i.onResultCellClicked(b,c)}}function d(b,c){var e,f,g,h=[],j=a.map(b.pivotvalues||[],function(a){return a.pivotValue===c?a.result:null});if(i.aggregatefunc){if(j.length>=1)for(e=0;e<j.length;e+=1)h.push(i.parseNumFunc?i.parseNumFunc(j[e]):j[e]);else if(i.bTotals)for(f=0;f<b.children.length;f+=1)h.push(d(b.children[f],c));g=i.aggregatefunc(h)}else g=null;return g}function e(b,c,f){var g,h,j,k,l,m,n,o,p,q,r=f.alGroupByCols,s=f.uniquePivotValues,t=i.bCollapsible?"foldunfold":"nonfoldunfold",u="."+t;for(g=0;g<b.children.length;g+=1){for(k=new lib.StringBuilder,l=b.children[g],m=void 0===l.groupbyText||null===l.groupbyText||"&nbsp;"===l.groupbyText||""===l.groupbyText?i.noGroupByText:l.groupbyText,k.append('<tr class="level'),k.append(l.groupbylevel),k.append('">'),h=0;h<r.length;h+=1)k.append('<th class="groupby level'),k.append(h),k.append('">'),r[h].colindex===l.colindex?l.children.length>0?(k.append('<span class="'),k.append(t),k.append(' collapsed">'),k.append(m),k.append(" </span>")):k.append(m):k.append(" "),k.append("</th>");for(k.append("</tr>"),c=a(k.toString()).insertAfter(c),c.find(u).data("status",{bDatabound:!1,treeNode:l}),p=[],j=0;j<s.length;j+=1)n=d(l,s[j].pivotValue),i.bTotals&&p.push(n),k.clear(),k.append('<td class="resultcell">'),k.append(i.formatFunc(n)),k.append("</td>"),o=a(k.toString()).appendTo(c),o.data("def",{pivot:s[j],treeNode:l});if(i.bTotals&&(k.clear(),k.append('<td class="total">'),k.append(i.formatFunc(i.aggregatefunc(p))),k.append("</td>"),a(k.toString()).appendTo(c)),!i.bCollapsible&&(q=c.find(u),q.length>0)){var v=q.removeClass("collapsed").data("status");v.treeNode.collapsed=!1,v.bDatabound=!0,e(v.treeNode,c,f),c=c.nextUntil(".total").last()}}}function f(b,c){var f,g,h,j,k,l=[],m=new lib.StringBuilder('<table class="pivot">'),n=b.alGroupByCols,o=b.uniquePivotValues;for(m.append('<tr class="head">'),f=0;f<n.length;f+=1)m.append('<th class="groupby level'),m.append(f),m.append('">'),m.append(n[f].text),m.append("</th>");for(g=0;g<o.length;g+=1)m.append('<th class="pivotcol">'),m.append(o[g].pivotValue),m.append("</th>");if(i.bTotals&&m.append('<th class="total">Total</th>'),m.append("</tr>"),i.bTotals){for(m.append('<tr class="total">'),m.append('<th class="total" colspan="'),m.append(n.length),m.append('">Total</th>'),h=0;h<o.length;h+=1)j=d(b.tree,o[h].pivotValue),i.bTotals&&l.push(j),m.append("<td>"),m.append(i.formatFunc(j)),m.append("</td>");m.append('<td class="total">'),m.append(i.formatFunc(i.aggregatefunc(l))),m.append("</td>"),m.append("</tr>")}m.append("</table>"),c.html(""),k=a(m.toString()).appendTo(c),k.data("jquery.pivot.adapter",b),e(b.tree,a("tr:first",k),b)}function g(a){var b,c,d,f=a.closest("table.pivot").data("jquery.pivot.adapter"),g=a.data("status"),h=a.closest("tr"),i=!1;if(g.treeNode.collapsed=!g.treeNode.collapsed,g.treeNode.collapsed?a.addClass("collapsed"):a.removeClass("collapsed"),g.bDatabound)for(b=h,c=g;(b=b.next()).length>0&&(d=b.find(".foldunfold").data("status"),!(d&&d.treeNode.groupbylevel<=g.treeNode.groupbylevel||b.is(".total")));)d?(c=d,i=c.treeNode.visible()):i=c.treeNode.visible()&&!c.treeNode.collapsed,b.toggle(i);else e(g.treeNode,h,f),g.bDatabound=!0}function h(){g(a(this))}var i=a.extend({},a.fn.pivot.defaults,b);return this.each(function(){var b=a(this),d=new data.adapter;d.sortPivotColumnHeaders=i.sortPivotColumnHeaders,b.empty(""),("object"==typeof i.source&&i.source.jquery||i.source.columns)&&(i.source.jquery?i.source.find("tr").length>0&&d.parseFromXhtmlTable(i.source):d.parseJSONsource(i.source),b.off("click.jquery.pivot"),b.on("click.jquery.pivot",".pivot .foldunfold",h),i.onResultCellClicked&&b.on("click.jquery.pivot",".resultcell",c),f(d,b)),""===b.html()&&b.html("<h1>"+i.noDataText+"</h1>")})},a.fn.pivot.defaults={source:null,bTotals:!0,bCollapsible:!0,aggregatefunc:b,formatFunc:function(a){return a},parseNumFunc:function(a){return+a},onResultCellClicked:null,noGroupByText:"No value",noDataText:"No data",sortPivotColumnHeaders:!0},a.fn.pivot.formatDK=function(a,b){return this.formatLocale(a,b,".",",")},a.fn.pivot.formatUK=function(a,b){return this.formatLocale(a,b,",",".")},a.fn.pivot.formatLocale=function(a,b,c,d){var e,f=0>a,g=Math.round(a*Math.pow(10,b)),h=Math.abs(g).toString().split(""),i=h.length-b;if(0>=i){for(e=0;-i>=e;e+=1)h.unshift("0");i=1}for(b>0&&h.splice(i,0,d);i>3;)i-=3,h.splice(i,0,c);return f&&h.splice(0,0,"-"),h.join("")}}(jQuery);