var jquerypivot;!function(a){!function(a){function b(a,b,c){var d,e,f,g=[];if(a){for(d=0,e=a.length;e>d;d+=1)f=b.call(c,a[d],d,a),f&&g.push(f);return g}}function c(b,c,d){var e;return e="function"==typeof b.filter?b.filter(c,d):a.map(b,function(a,b,e){return c.call(d,a,b,e)?a:null},d),e.length>0?e[0]:null}function d(a,b,c){var d,e;if(a){if("function"==typeof a.some)return a.some(b,c);for(d=0,e=a.length;e>d;d+=1)if(b.call(c,a[d],d,a))return!0}return!1}var e=function(){function a(a){this.strings=[""],this.append(a)}return a.prototype.append=function(a){null!==a&&this.strings.push(a)},a.prototype.clear=function(){this.strings.length=1},a.prototype.toString=function(){return this.strings.join("")},a}();a.StringBuilder=e,a.map=b,a.find=c,a.exists=d}(a.lib||(a.lib={})),a.lib}(jquerypivot||(jquerypivot={}));var jquerypivot;!function(a){function b(a,b){var c=+a.groupbyrank,d=+b.groupbyrank;return d>c?-1:c>d?1:0}function c(a){return"string"==typeof a||null===a?$.trim(a):a}var d=function(){function a(){this.children=[],this.pivotvalues=[]}return a.prototype.visible=function(){return void 0===this.parent||!this.parent.collapsed&&(!this.parent.visible||this.parent.visible())},a}();a.TreeNode=d;var e=function(){function e(){this.alGroupByCols=[],this.pivotCol=null,this.resultCol=null,this.bInvSort=!1,this.tree=new d,this.uniquePivotValues=[],this.dataid=null,this.sortPivotColumnHeaders=!0}return e.prototype.sortTree=function(a){var b,c;if(a.children&&a.children.length>0){for(b=0;b<a.children.length;b+=1)this.sortTree(a.children[b]);c=this.findCell(this.alGroupByCols,a.children[0].colindex).datatype,a.children.sort(this.getcomparer(this.bInvSort)[c])}},e.prototype.findCell=function(b,c){return a.lib.find(b,function(a){return a.colindex==this},c)},e.prototype.getcomparer=function(a){function b(b){return function(c,d){var e=b(c.sortby)<b(d.sortby)?-1:b(c.sortby)>b(d.sortby)?1:0;return a?-e:e}}return{string:b(function(a){return a}),number:b(function(a){return+a})}},e.prototype.parseJSONsource=function(e){function f(a){return a.groupbyValue==this}function g(a){return a.pivotValue==this}var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;for(this.dataid=e.dataid,h=0,i=e.columns.length;i>h;h+=1)m=e.columns[h],n={colvalue:m.colvalue,coltext:m.coltext,text:m.header||m.coltext||m.colvalue,colindex:h,datatype:m.datatype||"string",sortbycol:m.sortbycol||m.coltext||m.colvalue,dataid:m.dataid||m.colvalue,groupbyrank:m.groupbyrank},"number"==typeof n.groupbyrank&&isFinite(n.groupbyrank)?this.alGroupByCols.push(n):m.pivot?this.pivotCol=n:m.result&&(this.resultCol=n);for(this.alGroupByCols.sort(b),j=0,k=e.rows.length;k>j;j+=1){for(x=e.rows[j],o=this.tree,l=0;l<this.alGroupByCols.length;l+=1)q=c(x[this.alGroupByCols[l].colvalue]),r=x[this.alGroupByCols[l].coltext],s=c(x[this.alGroupByCols[l].sortbycol]),p=a.lib.find(o.children,f,q),p||(p=new d,p.groupbyValue=q,p.groupbyText=r,p.colindex=this.alGroupByCols[l].colindex,p.children=[],p.sortby=s,p.parent=o,p.dataid=this.alGroupByCols[l].dataid,p.collapsed=!0,p.groupbylevel=l,o.children.push(p)),o=p;t=c(x[this.pivotCol.colvalue]),u=c(x[this.pivotCol.sortbycol]),v=c(x[this.resultCol.colvalue]),w={pivotValue:t,result:v,sortby:u,dataid:this.pivotCol.dataid},o.pivotvalues.push(w),a.lib.exists(this.uniquePivotValues,g,t)||this.uniquePivotValues.push(w)}this.sortTree(this.tree),this.sortPivotColumnHeaders&&this.uniquePivotValues.sort(this.getcomparer(this.bInvSort)[this.pivotCol.datatype])},e.prototype.parseFromHtmlTable=function(a){var b,c,d,e,f,g,h,i,j,k={dataid:a.data("pivot-dataid"),columns:[],rows:[]},l=$("tbody > tr",a),m=[];for(b=0,c=l[0].cells.length;c>b;b+=1)f=$(l[0].cells[b]),g=f.text(),h={colvalue:f.data("pivot-colvalue")||g,coltext:f.data("pivot-coltext")||g,header:f.data("pivot-header")||f.text(),datatype:f.data("pivot-datatype"),sortbycol:f.data("pivot-sortbycol")||g,dataid:f.data("pivot-dataid"),groupbyrank:parseInt(f.data("pivot-groupbyrank"),10),pivot:f.data("pivot-pivot"),result:f.data("pivot-result")},k.columns.push(h),m.push(g);for(d=1,e=l.length;e>d;d+=1){for(i=l[d].cells,j={},b=0,c=m.length;c>b;b+=1)g=i[b].innerHTML,j[m[b]]="number"===k.columns[b].datatype?parseFloat(g):g;k.rows.push(j)}this.parseJSONsource(k)},e}();a.Adapter=e}(jquerypivot||(jquerypivot={}));var jquerypivot;!function(a){function b(a){var b,c,d=0;for(b=0,c=a.length;c>b;b+=1)d+=a[b];return d}function c(a,b){return this.formatLocale(a,b,".",",")}function d(a,b){return this.formatLocale(a,b,",",".")}function e(a,b,c,d){var e,f=0>a,g=Math.round(a*Math.pow(10,b)),h=Math.abs(g).toString().split(""),i=h.length-b;if(0>=i){for(e=0;-i>=e;e+=1)h.unshift("0");i=1}for(b>0&&h.splice(i,0,d);i>3;)i-=3,h.splice(i,0,c);return f&&h.splice(0,0,"-"),h.join("")}$=jQuery;var f=function(){function a(a,c,d,e,f,g,h,i,j,k){"undefined"==typeof a&&(a=null),"undefined"==typeof c&&(c=!0),"undefined"==typeof d&&(d=!0),"undefined"==typeof e&&(e=b),"undefined"==typeof f&&(f=function(a){return a}),"undefined"==typeof g&&(g=function(a){return+a}),"undefined"==typeof h&&(h=null),"undefined"==typeof i&&(i="No value"),"undefined"==typeof j&&(j="No data"),"undefined"==typeof k&&(k=!0),this.source=a,this.bTotals=c,this.bCollapsible=d,this.aggregatefunc=e,this.formatFunc=f,this.parseNumFunc=g,this.onResultCellClicked=h,this.noGroupByText=i,this.noDataText=j,this.sortPivotColumnHeaders=k}return a}();a.jqueryPivotOptions=f;var g=function(){function a(a,b,c){this.dataidPivot=a,this.pivotvalue=b,this.pivotsortvalue=c}return a}();a.resultCellClickedInfoPivotInfo=g;var h=function(){function a(a,b){this.dataidGroup=a,this.groupbyval=b}return a}();a.resultCellClickedInfoGroupByInfo=h;var i=function(){function a(a,b,c){this.dataidTable=a,this.pivot=b,this.groups=c}return a}();a.resultCellClickedInfo=i;var j=function(){function a(a,b){this.bDatabound=a,this.treeNode=b}return a}(),k=function(){function b(b){var c=this;this.resultCellClicked=function(a){var b,d=$(a.target),e=d.closest("table.pivot").data("jquery.pivot.adapter"),f=[],j=d.data("def"),k=j.treeNode;if(c.opts.onResultCellClicked){for(d.closest("table.pivot").find(".resultcell").removeClass("clickedResultCell"),d.addClass("clickedResultCell");k.parent;)f.unshift(new h(k.dataid,k.groupbyValue)),k=k.parent;b=new i(e.dataid,new g(j.pivot.dataid,j.pivot.pivotValue,j.pivot.sortby),f),c.opts.onResultCellClicked(b,d)}},this.getResValue=function(b,d){var e,f,g=[],h=a.lib.map(b.pivotvalues||[],function(a){return a.pivotValue===d?a.result:null});if(c.opts.aggregatefunc){if(h.length>=1)for(e=0;e<h.length;e+=1)g.push(c.opts.parseNumFunc?c.opts.parseNumFunc(h[e]):h[e]);else if(c.opts.bTotals)for(e=0;e<b.children.length;e+=1)g.push(c.getResValue(b.children[e],d));f=c.opts.aggregatefunc(g)}else f=null;return f},this.appendChildRows=function(b,d,e){var f,g,h,i,k,l,m,n,o,p,q,r=e.alGroupByCols,s=e.uniquePivotValues,t=c.opts.bCollapsible?"foldunfold":"nonfoldunfold",u="."+t;for(f=0;f<b.children.length;f+=1){for(i=new a.lib.StringBuilder,k=b.children[f],l=void 0===k.groupbyText||null===k.groupbyText||"&nbsp;"===k.groupbyText||""===k.groupbyText?c.opts.noGroupByText:k.groupbyText,i.append('<tr class="level'),i.append(k.groupbylevel),i.append('">'),g=0;g<r.length;g+=1)i.append('<th class="groupby level'),i.append(g),i.append('">'),r[g].colindex===k.colindex?k.children.length>0?(i.append('<span class="'),i.append(t),i.append(' collapsed">'),i.append(l),i.append(" </span>")):i.append(l):i.append(" "),i.append("</th>");for(i.append("</tr>"),d=$(i.toString()).insertAfter(d),d.find(u).data("status",new j(!1,k)),o=[],h=0;h<s.length;h+=1)m=c.getResValue(k,s[h].pivotValue),c.opts.bTotals&&o.push(m),i.clear(),i.append('<td class="resultcell">'),i.append(c.opts.formatFunc(m)),i.append("</td>"),n=$(i.toString()).appendTo(d),n.data("def",{pivot:s[h],treeNode:k});c.opts.bTotals&&(i.clear(),i.append('<td class="total">'),i.append(c.opts.formatFunc(c.opts.aggregatefunc(o))),i.append("</td>"),$(i.toString()).appendTo(d)),c.opts.bCollapsible||(p=d.find(u),p.length>0&&(q=p.removeClass("collapsed").data("status"),q.treeNode.collapsed=!1,q.bDatabound=!0,c.appendChildRows(q.treeNode,d,e),d=d.nextUntil(".total").last()))}},this.makeCollapsed=function(b,d){var e,f,g,h,i=[],j=new a.lib.StringBuilder('<table class="pivot">'),k=b.alGroupByCols,l=b.uniquePivotValues;for(j.append('<tr class="head">'),e=0;e<k.length;e+=1)j.append('<th class="groupby level'),j.append(e),j.append('">'),j.append(k[e].text),j.append("</th>");for(e=0;e<l.length;e+=1)j.append('<th class="pivotcol">'),j.append(l[e].pivotValue),j.append("</th>");if(c.opts.bTotals&&j.append('<th class="total">Total</th>'),j.append("</tr>"),c.opts.bTotals){for(j.append('<tr class="total">'),j.append('<th class="total" colspan="'),j.append(k.length),j.append('">Total</th>'),f=0;f<l.length;f+=1)g=c.getResValue(b.tree,l[f].pivotValue),c.opts.bTotals&&i.push(g),j.append("<td>"),j.append(c.opts.formatFunc(g)),j.append("</td>");j.append('<td class="total">'),j.append(c.opts.formatFunc(c.opts.aggregatefunc(i))),j.append("</td>"),j.append("</tr>")}j.append("</table>"),d.html(""),h=$(j.toString()).appendTo(d),h.data("jquery.pivot.adapter",b),c.appendChildRows(b.tree,$("tr:first",h),b)},this.foldunfoldElem=function(a){var b,d,e,f=a.closest("table.pivot").data("jquery.pivot.adapter"),g=a.data("status"),h=a.closest("tr"),i=!1;if(g.treeNode.collapsed=!g.treeNode.collapsed,g.treeNode.collapsed?a.addClass("collapsed"):a.removeClass("collapsed"),g.bDatabound)for(b=h,d=g;(b=b.next()).length>0&&(e=b.find(".foldunfold").data("status"),!(e&&e.treeNode.groupbylevel<=g.treeNode.groupbylevel||b.is(".total")));)e?(d=e,i=d.treeNode.visible()):i=d.treeNode.visible()&&!d.treeNode.collapsed,b.toggle(i);else c.appendChildRows(g.treeNode,h,f),g.bDatabound=!0},this.foldunfold=function(a){c.foldunfoldElem($(a.target))},this.opts=$.extend({},$.fn.pivot.defaults,b)}return b}();a.pivot=k,$.fn.pivot=function(b){var c=new k(b);return this.each(function(){var b=$(this),d=new a.Adapter,e=c.opts;d.sortPivotColumnHeaders=e.sortPivotColumnHeaders,b.empty(),("object"==typeof e.source&&e.source.jquery||e.source.columns)&&(e.source.jquery?e.source.find("tr").length>0&&d.parseFromHtmlTable(e.source):d.parseJSONsource(e.source),b.off("click.jquery.pivot"),b.on("click.jquery.pivot",".pivot .foldunfold",c.foldunfold),e.onResultCellClicked&&b.on("click.jquery.pivot",".resultcell",c.resultCellClicked),c.makeCollapsed(d,b)),""===b.html()&&b.html("<h1>"+e.noDataText+"</h1>")})},$.fn.pivot.defaults=new f,$.fn.pivot.formatDK=c,$.fn.pivot.formatUK=d,$.fn.pivot.formatLocale=e}(jquerypivot||(jquerypivot={}));